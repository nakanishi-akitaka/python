# -*- coding: utf-8 -*-
"""
Created on Thu Mar 28 18:08:25 2019

@author: Akitaka
"""

[1] 機械学習
[1a] サイトで勉強　金子研究室
データ解析に関するいろいろな手法・考え方のまとめ
https://datachemeng.com/summarydataanalysis/
学生・研究者へ
https://datachemeng.com/forstudentsresearchers/


[1a2]
https://twitter.com/hirokaneko226/status/1110663454346502144
原子団寄与法に基づいて、化学構造・温度・圧力からイオン液体の密度を推定するQSPRに関する論文。
2267のイオン液体でサンプル数は41250。OLS, SVR, ニューラルネットワークでモデル構築。
クロスバリデーション、外部バリデーション、yランダマイゼーションでモデル検証

https://doi.org/10.1021/acs.iecr.9b00130
https://pubs.acs.org/doi/10.1021/acs.iecr.9b00130
"Extensive Databases and Group Contribution QSPRs of Ionic Liquids Properties.
 1. Density"
Kamil Paduszyński
Ind. Eng. Chem. Res., Article ASAP



[1a3]
https://twitter.com/hirokaneko226/status/1111023050810548225
PLS (partial least squares) で主成分スコアを計算してから、
主成分空間で予測したいサンプルと距離の近いトレーニングデータのみ選択し、
局所的なPLSモデルを構築する論文。近赤外スペクトルのデータセットで検証


https://doi.org/10.1002/cem.3117
https://onlinelibrary.wiley.com/doi/10.1002/cem.3117
"Local partial least squares based on global PLS scores"
Guanghui Shen, et al.,

つまりは、空間全体で主成分分析＋予測したいサンプル近くだけでモデル作成、ということ？


[1a4] 20190312より
https://twitter.com/hirokaneko226/status/1105237116550828032
    イオン液体の密度・熱容量・粘度・表面張力・融点を推定するQSPRの論文。
    6個のカチオン、19個のアニオン、4個の置換基をカバーする約200のイオン液体で、
    色々な温度・圧力における測定データ 13300 以上を収集して使用。
    原子団寄与法で推定。溶媒となる新たなイオン液体を検討


https://doi.org/10.1021/acs.iecr.8b05040
"Group Contribution Based Estimation Method for Properties of Ionic Liquids"
Yuqiu Chen, et al.,
Ind. Eng. Chem. Res.  XXXX, XXX, XXX-XXX






[1b] 水素化合物Tcデータベースに追加したデータを用いて、モデルの検証

20190227 tc_pred.pyを改造する
三元系のデータは使用しない

使用した特徴量 = [amass, eion1, aradi, meltp, nvale]からなる50個

学習用データのスコア
Best parameters set found on development set:
{'max_features': 0.8}
C:  RMSE, MAE, R^2 = 10.932,  6.930,  0.962
CV: RMSE, MAE, R^2 = 24.799, 16.049,  0.806
TST:RMSE, MAE, R^2 = 18.740, 13.110,  0.909

追加したデータに対する結果
TST:RMSE, MAE, R^2 = 46.337, 28.317,  0.582
正直、良いとは言えない

ADはほとんど1(OK)

※ずれが大きいものを、インデントする

formula,P,Tc(pred),Tc(DB)
SeH6,150,36,39
    ...
ScH2,300,6,4

ScH3,400,0,1

ScH4,120,87,92

ScH6,250,72,29

ScH6,350,125,135

ScH7,300,171,169

ScH8,300,121,117

ScH9,300,165,163

ScH10,250,171,120

ScH12,350,159,141

C6H6,185,10,7

YH3,120,8,19
...
YH4,120,81,94
...
YH6,120,258,250

YH9,150,259,253

YH10,400,294,287

LaH6,100,155,154

LaH9,50,24,21

CeH9,100,50,47

CeH10,200,76,59

    LaH4,300,52,5

LaH8,300,105,114

LaH10,210,225,219
...

YH10,300,245,233
...

VH,200,3,2
...
VH2,200,7,6
...
VH3,200,4,4

    VH5,200,94,11
    ...
    VH8,300,129,62
    ...

ScH3,18,3,19

LaH3,11,44,22

CrH,0,5,10
...
CrH3,81,36,37
...
    ThH3,100,41,0
    ...
    Th3H10,10,49,3
    ...
    ThH4,85,81,3
    ...
    ThH7,100,132,64
    ...
ThH10,100,204,221
...
    UH10,100,233,50
    ...
    CaH4,200,76,11
    ...
    CaH9,300,155,266
    ...
    CaH10,400,129,175

BH2,250,36,37
...
BH,250,19,4

CaH6,250,183,187
...

PbH8,200,84,85
...
    AlH3,165,33,6

LaH10,200,225,288

    LaH4,300,52,10

    LaH8,300,105,131
    # 同じLa系でも、水素の数によっては大外れ。

YH10,250,254,265

PtH,90,19,11
...
SiH4,220,42,16

GeH4,220,53,64

    SnH4,70,26,58
    ...
YH4,120,81,84
YH6,120,258,264
    MgH6,300,106,263
    ...
IH2,100,5,5
...
IH4,120,13,9
...
    PH1,250,20,82
    ...
PH2,80,41,47
...
PH3,80,69,44
...
YH6,200,258,220

CaH6,200,183,197

RuH1,100,8,0

    RuH3,100,22,3
    
    FeH5,300,69,28
    ...

    FeH6,100,50,3
    # 同じ化合物でも、圧力によっては大外れ。
FeH6,150,49,42
FeH6,300,50,37

BeH2,230,37,30
...
SrH6,250,117,108

PtH,113,14,17
...

TaH2,200,13,5

TaH4,250,64,23

TaH6,300,127,124

NbH4,300,44,46

VH2,60,8,4

NbH2,0,2,1
...
ZrH,120,1,10

TiH2,0,11,6

ScH2,0,12,22
...
XeH,100,6,28
...
XeH2,400,8,28
...
    B2H6,360,52,125

    AlH3,110,37,1
    ...
    GaH3,120,60,122

    InH3,300,71,31
    ...
    InH5,150,66,22

SiH4,125,42,46
...
    SiH8,250,150,107

    Si2H6,175,40,64
    Si2H6,200,40,80
    Si2H6,275,37,138
Si2H6,300,37,33
    # 同じ化合物でも、圧力によっては大外れ。
    
Si2H6,100,42,20
...

GeH4,20,49,47

    GeH8,230,174,73
    ...
    GeH3,180,41,140

SnH8,250,68,72
...
PH,80,19,12

PH2,80,41,30
...
PH4,80,46,1

SbH4,150,92,95
...
SbH,200,11,6
...
BiH2,125,49,39

BiH3,270,46,65

SbH3,170,26,68

PoH,300,4,0

PoH2,200,4,0

PoH4,200,47,41

PoH6,200,11,2

PoH4,150,56,32
...
ClH2,400,36,43

    BrH,140,0,21
    ...
ClH,240,14,3
...

    BrH,150,0,28
    ...
BrH2,240,7,7

    BrH4,240,58,0

SH2,100,33,42
...

同じLa系でも、水素の数によっては大外れ。
同じ化合物でも、圧力次第でずれが大幅に変わる
=>
単純に法則性が成り立たないのか、それがまだつかめていないのか？
もっとも、RFという手法のせいかもしれないが

ref:20181119
テストデータ・バリデーションデータ(モデル検証用データ)におけるモデルの精度が低いときのポジティブな側面
https://datachemeng.com/lowpredictiveability/
テストデータにおいて説明変数 X の値から目的変数 y の値を推定したとき、
全体的にトレーニングデータにおける推定誤差と同じくらいの誤差であれば happy、というわけです。
X と y の間の新しい関係を発見できたかも！？
    トレーニングデータにおける関係とは異なる関係がテストデータにはあるハズ
    トレーニングデータで構築したモデルと、最終的に用いるモデルとは異なります。
        最終的に用いるモデルは、トレーニングデータもテストデータも含むすべてのデータを用いて
        構築されたモデルなわけです。
    100点満点の試験で50点を取ってしまっても、復習して次に100点を取れれば OK !!





[1c] メモ
20190117 tc_mlp.py




[1d] 遺伝的アルゴリズム & ランダム構造探索 テスト計算

20190327で一旦終わり　まとめを以下に残す
[1b1] 基本設定と履歴
1.ランダム構造探索 = 0世代、100個体の遺伝的アルゴリズム
2.遺伝的アルゴリズム、4世代、10個体、選別率 0.2、変異率 0.5
    ecutwfc, ecutrho, kgridは適宜最適化し、その時のvcrelaxを基にv_aveを決める
0222 Al
0225 2Si, 2C, 2Be
0226 4C run1,run2(実行中)
0227 4C run2, 4Si(中止), 2Mg(中止), Ca(実行中)
0228 Ca-RS, Li-RS
0301 Ca-GA, Li-GA, Na(実行中), K(実行中)
0304 Na, K, V(実行中), Nb(実行中)
0305-07 V(実行中), Nb(実行中)
0308-13 V(実行中), Nb(終了), 4C(終了), 2Mg(実行中)
0314 4C精度やや上げ V(実行中)　2Mg(実行中)
0315 V
0319 2Mg RS
0327 2Mg GA





